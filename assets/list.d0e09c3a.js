var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;import{d as s,r as d,o as r,c,w as p,e as u,a as h,f,F as m,h as b,t as g,p as y,g as v,b as D,x as w}from"./vendor.b3a2989e.js";var C=s({emits:["update:search","search","operation-request","operation-visible"],props:{search:{type:String,default:""},headOperation:{type:Array,default:()=>[]}},data(){return{searched:!1,content:this.search}},watch:{search(){this.content=this.search},content(){this.$emit("update:search",this.content),this.searched=!1}},methods:{handleButton(e,t,a){console.log(a);({request:()=>this.$emit("operation-request",a),router:()=>this.$router.push(t),open:()=>this.$emit("operation-visible")})[e]()},handleSearch(){this.$emit("search",this.content),this.searched=!0},handleRefresh(){this.content="",this.$emit("update:search",this.content),this.$emit("search",this.content)}}});const O={key:0,class:"refresh"},$={key:1,class:"search"};C.render=function(e,t,a,l,o,i){const n=d("el-button"),s=d("el-col"),y=d("el-input"),v=d("el-row");return r(),c(v,{gutter:20},{default:p((()=>[u(s,{span:10},{default:p((()=>[(r(!0),h(m,null,f(e.headOperation,(t=>(r(),c(n,{key:t.text,icon:t.icon,type:t.type,onClick:a=>e.handleButton(t.event,t.path,t.url)},{default:p((()=>[b(g(t.text),1)])),_:2},1032,["icon","type","onClick"])))),128))])),_:1}),u(s,{span:14},{default:p((()=>[u(y,{modelValue:e.content,"onUpdate:modelValue":t[0]||(t[0]=t=>e.content=t),placeholder:"输入查询条件",clearable:""},{append:p((()=>[e.searched?(r(),h("span",O,[u(n,{icon:"el-icon-refresh-right",onClick:e.handleRefresh},null,8,["onClick"])])):(r(),h("span",$,[u(n,{icon:"el-icon-search",onClick:e.handleSearch},null,8,["onClick"])]))])),_:1},8,["modelValue"])])),_:1})])),_:1})};var k=s({emits:["update:page","page"],props:{total:{type:Number,defualt:0},page:{type:Number,default:0}},data(){return{current:this.page}},watch:{page(e){this.current=e},current(e){this.$emit("update:page",e),this.$emit("page",e)}}});const V={class:"pagination"};k.render=function(e,t,a,l,o,i){const n=d("el-pagination");return r(),h("div",V,[u(n,{background:"",layout:"prev, pager, next","page-size":20,total:e.total,"current-page":e.current,"onUpdate:current-page":t[0]||(t[0]=t=>e.current=t)},null,8,["total","current-page"])])};var _=s({emits:["data-delete","data-edit","business-operation","business-edit"],props:{data:{type:Object,default:()=>{}},index:{type:Number,default:0},businessOperation:{type:Array,default:()=>[]},operation:{type:Object,default:()=>{}}},data:()=>({}),methods:{handleBusiness(e,t,a){"open"===a.type?this.$emit("business-edit",[e,t,a]):this.$msgbox({title:a.text,message:a.desc,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",showCancelButton:!0,showInput:"prompt"===a.type}).then((({value:l=""})=>{const o={};for(const t in a.body){const i=t.split(":")[0],n=t.split(":")[1];"key"===i?o[n]=e[a.body[t]]:"val"===i?o[n]=a.body[t]:"input"===i&&(o[n]=l)}this.$emit("business-operation",[o,t,a])})).catch((()=>this.$message({type:"info",message:"取消操作"})))}}});y("data-v-fb4bc788");const x={class:"div"},U={key:0,class:"business-operation"},S=D("h4",null,"业务操作",-1),q={key:0,class:"btn"},E={class:"data-operation"},I=D("h4",null,"数据操作",-1),R={class:"btn edit"},j=b("编辑"),B={class:"btn delete"};v(),_.render=function(e,t,a,l,o,i){const n=d("el-button"),s=d("hwd-btn-delete"),y=d("el-popover");return r(),c(y,{placement:"bottom",trigger:"click"},{reference:p((()=>[u(n,{size:"mini",icon:"el-icon-more"})])),default:p((()=>[D("div",x,[e.businessOperation&&e.businessOperation.length>0?(r(),h("div",U,[S,(r(!0),h(m,null,f(e.businessOperation,(t=>(r(),h(m,{key:t},[e.data.state===t.state?(r(),h("div",q,[u(n,{size:"mini",icon:t.icon||"el-icon-warning-outline",onClick:a=>e.handleBusiness(e.data,e.index,t)},{default:p((()=>[b(g(t.text),1)])),_:2},1032,["icon","onClick"])])):w("",!0)],64)))),128))])):w("",!0),D("div",E,[I,D("div",R,[u(n,{size:"mini",icon:"el-icon-edit-outline",disabled:!e.operation.edit,onClick:t[0]||(t[0]=t=>e.$emit("data-edit"))},{default:p((()=>[j])),_:1},8,["disabled"])]),D("div",B,[u(s,{text:"删除",removeID:e.data._id,disabled:!e.operation.delete,onConfirm:t[1]||(t[1]=t=>e.$emit("data-delete",t))},null,8,["removeID","disabled"])])])])])),_:1})},_.__scopeId="data-v-fb4bc788";var F=s({components:{"hwd-operation":_},emits:["data-delete","data-edit","business-operation","business-edit"],props:{tableData:{type:Array,default:()=>[]},fields:{type:Array,default:()=>[]},expand:{type:Array,default:()=>[]},businessOperation:{type:Array,default:()=>[]},operation:{type:Object,default:()=>({})}},methods:{formatField(e,t,a,l){const o=t.no-(this.expand.length>0?2:1),i=this.fields[o].format;if("number"==typeof a){return{amount:a.toFixed(2)}[i.type]}if("string"==typeof a)return i[a]}}});y("data-v-14af5c7f");const P={class:"self"},A=D("h2",null,"更多信息",-1);v(),F.render=function(e,t,a,l,o,i){const n=d("el-table-column"),s=d("el-form-item"),b=d("el-form"),y=d("hwd-operation"),v=d("el-table");return r(),c(v,{data:e.tableData,stripe:"",height:"100%"},{default:p((()=>[u(n,{type:"index",width:"50"}),e.expand.length>0?(r(),c(n,{key:0,type:"expand"},{default:p((t=>[u(b,{"label-position":"left",inline:"",class:"demo-table-expand"},{default:p((()=>[D("div",P,[A,(r(!0),h(m,null,f(e.expand,(e=>(r(),c(s,{key:e.field,label:e.label},{default:p((()=>[D("span",null,g(t.row[e.field]),1)])),_:2},1032,["label"])))),128))])])),_:2},1024)])),_:1})):w("",!0),(r(!0),h(m,null,f(e.fields,(t=>(r(),c(n,{key:t.prop,"show-overflow-tooltip":"","min-width":t.width,align:t.align||"center",prop:t.prop,label:t.label,formatter:t.format&&e.formatField},null,8,["min-width","align","prop","label","formatter"])))),128)),u(n,{label:"操作",align:"center",width:"100",fixed:"right"},{default:p((a=>[u(y,{data:a.row,index:a.$index,businessOperation:e.businessOperation,operation:e.operation,onBusinessEdit:t[0]||(t[0]=t=>e.$emit("business-edit",t[0],t[1],t[2])),onBusinessOperation:t[1]||(t[1]=t=>e.$emit("business-operation",t[0],t[1],t[2])),onDataEdit:t=>e.$emit("data-edit",a.row,a.$index),onDataDelete:t[2]||(t[2]=t=>e.$emit("data-delete",t))},null,8,["data","index","businessOperation","operation","onDataEdit"])])),_:1})])),_:1},8,["data"])},F.__scopeId="data-v-14af5c7f";var N=s({emits:["update:modelValue"],props:{modelValue:String,config:{type:Object,default:()=>{}},placeholder:String},data(){return{selected:this.modelValue,options:[]}},watch:{modelValue(e){this.selected=e},selected(e){this.$emit("update:modelValue",e)}},mounted(){this.getData()},methods:{getData(){this.$httpRequest({url:this.config.url,onSuccess:e=>this.options=e.list})}}});N.render=function(e,t,a,l,o,i){const n=d("el-option"),s=d("el-select");return r(),c(s,{modelValue:e.selected,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selected=t),placeholder:e.placeholder},{default:p((()=>[(r(!0),h(m,null,f(e.options,(t=>(r(),c(n,{key:t[e.config.value],label:t[e.config.label],value:t[e.config.value]},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])};var T=s({emits:["cancel","update-success","create-success","success","fail"],components:{"hwd-select":N},props:{editData:{type:Object,default:()=>{}},config:{type:Object,defult:()=>{}}},data(){return{form:this.editData,http:{},editorConfig:[]}},watch:{editData(e){this.form=e}},mounted(){this.getData()},methods:{getData(){const e=sessionStorage.getItem("frame");if(e){const t=JSON.parse(e)[this.$route.params.view];this.http=t.http,this.editorConfig=t.editorConfig}},handleUpload(e){return this.onUpload(this.$refs.upload.action,{file:e,callback:e=>this.form.cover=e}),!1},onUpload(e,t){const{file:a,callback:l}=t,o=`goods-cover-${this.form.id||a.name}-${Date.now()}.jpg`,i=new FormData;i.append("path",o),i.append("file",a),this.$httpRequest({url:e,method:"post",data:i,onSuccess:e=>{l&&l(e.url)}})},handleSubmit(){const{url:e,method:s,body:d}=this.config,r={};if(e){r.url=e,r.method=s,r.data={};for(const e in d){const t=e.split(":")[0],a=e.split(":")[1];"key"===t?r.data[a]=this.form[d[e]]:"val"===t&&(r.data[a]=d[e])}}else r.url=this.form._id?this.http.update:this.http.create,r.method=this.form._id?"put":"post",r.data=this.form;var c;this.$httpRequest((c=((e,t)=>{for(var a in t||(t={}))o.call(t,a)&&n(e,a,t[a]);if(l)for(var a of l(t))i.call(t,a)&&n(e,a,t[a]);return e})({},r),t(c,a({onSuccess:e=>{this.config.url?this.$emit("success",e):this.$emit(this.form._id?"update-success":"create-success",e)},onFail:()=>this.$emit("fail")}))))},handleCancel(){this.$emit("cancel")}}});y("data-v-06df825e");const z={id:"view-editor"},H={class:"editor-form"},J={class:"avatar-cover"},L=["src"],G={key:1,class:"el-icon-plus avatar-uploader-icon"},K=b("取消");v(),T.render=function(e,t,a,l,o,i){const n=d("el-date-picker"),s=d("el-option"),y=d("el-select"),v=d("hwd-select"),w=d("el-switch"),C=d("el-upload"),O=d("hwd-tinymce"),$=d("el-input"),k=d("el-form-item"),V=d("el-button"),_=d("el-form");return r(),h("div",z,[D("div",H,[u(_,{"label-position":"left",ref:"form",model:e.form,"label-width":"150px"},{default:p((()=>[(r(!0),h(m,null,f(e.config&&e.config.editor||e.editorConfig,(t=>(r(),c(k,{key:t,label:t.label},{default:p((()=>["datetime"===t.type?(r(),c(n,{key:0,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,type:t.type,placeholder:t.placeholder},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):"select"===t.type?(r(),c(y,{key:1,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,placeholder:t.placeholder},{default:p((()=>[(r(!0),h(m,null,f(t.options,(e=>(r(),c(s,{key:e.value,label:e.label||e.value,value:e.value,disabled:e.disabled},null,8,["label","value","disabled"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):"select-req"===t.type?(r(),c(v,{key:2,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,config:t.options[0],placeholder:t.placeholder},null,8,["modelValue","onUpdate:modelValue","config","placeholder"])):"switch"===t.type?(r(),c(w,{key:3,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,"active-value":t.switch.on,"inactive-value":t.switch.off},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value"])):"upload"===t.type?(r(),c(C,{key:4,class:"avatar-uploader",ref:"upload",action:t.uploadURL,"show-file-list":!1,"before-upload":e.handleUpload},{default:p((()=>[D("div",J,[e.form[t.field]?(r(),h("img",{key:0,src:e.form[t.field],class:"avatar"},null,8,L)):(r(),h("i",G))])])),_:2},1032,["action","before-upload"])):"textarea"===t.type?(r(),c(O,{key:5,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,onUploadImage:a=>e.onUpload(t.uploadURL,a)},null,8,["modelValue","onUpdate:modelValue","onUploadImage"])):(r(),c($,{key:6,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,type:t.type,placeholder:t.placeholder,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","type","placeholder","disabled"]))])),_:2},1032,["label"])))),128)),u(k,null,{default:p((()=>[u(V,{type:"primary",onClick:e.handleSubmit},{default:p((()=>[b(g(e.form._id?"更新":"创建"),1)])),_:1},8,["onClick"]),u(V,{onClick:e.handleCancel},{default:p((()=>[K])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])])},T.__scopeId="data-v-06df825e";var M=s({components:{"contact-head":C,"contact-table":F,"contact-page":k,"contact-editor":T},data:()=>({visible:!1,query:{search:"",page:1},pageTotal:0,tableData:[],editorConfig:{},editIndex:0,editData:{},frameConfig:{}}),mounted(){this.getData()},watch:{$route(e){/^\/list/.test(e.path)&&e.params.view&&this.getData()}},methods:{getData(){this.tableData=[];const e=sessionStorage.getItem("frame");if(e){const t=JSON.parse(e);this.frameConfig=t[this.$route.params.view],this.frameConfig&&this.$httpRequest({url:`${this.frameConfig.http.retrieve}?search=${this.query.search}&page=${this.query.page}`,onSuccess:e=>{this.tableData=e.list,this.pageTotal=e.total}})}},handleEdit(e,t,a){this.editIndex=t,a&&(this.editorConfig=a),this.editData=e,this.visible=!0},handleEditorUpdate(e){for(const t in e)this.tableData[this.editIndex][t]=e[t];this.visible=!1},handleEditorCreate(e){this.tableData.length>=19?this.getData():this.tableData.unshift(e),this.visible=!1},handleEditorFail(){},handleDelete(e){this.$httpRequest({url:`${this.frameConfig.http.delete}?id=${e}`,method:"delete",onSuccess:()=>this.tableData=this.tableData.filter((t=>t._id!==e))})},handleHeadOperationRequest(e){this.$httpRequest({url:e,onSuccess:e=>this.tableData.unshift(e)})},handleBusinessOperation(e,t,a){this.$httpRequest({url:a.url,method:a.method||"post",data:e,onSuccess:e=>{for(const a in e)this.tableData[t][a]=e[a]}})}}});y("data-v-ffb27d4e");const Q={id:"view-list"},W={class:"list-head"},X={class:"list-table"},Y={class:"list-foot"},Z={id:"view-list-dialog"};v(),M.render=function(e,t,a,l,o,i){const n=d("contact-head"),s=d("contact-table"),c=d("contact-page"),f=d("contact-editor"),b=d("el-dialog");return r(),h(m,null,[D("div",Q,[D("div",W,[u(n,{search:e.query.search,"onUpdate:search":t[0]||(t[0]=t=>e.query.search=t),headOperation:e.frameConfig?e.frameConfig.headOperation:[],onSearch:e.getData,onOperationRequest:e.handleHeadOperationRequest,onOperationVisible:t[1]||(t[1]=t=>e.visible=!0)},null,8,["search","headOperation","onSearch","onOperationRequest"])]),D("div",X,[u(s,{tableData:e.tableData,fields:e.frameConfig&&e.frameConfig.fields,expand:e.frameConfig&&e.frameConfig.expand,businessOperation:e.frameConfig?e.frameConfig.businessOperation:[],operation:e.frameConfig&&e.frameConfig.dataOperation,onDataEdit:t[2]||(t[2]=(t,a,l)=>e.handleEdit(t,a,l)),onDataDelete:t[3]||(t[3]=t=>e.handleDelete(t)),onBusinessEdit:t[4]||(t[4]=(t,a,l)=>e.handleEdit(t,a,l)),onBusinessOperation:e.handleBusinessOperation},null,8,["tableData","fields","expand","businessOperation","operation","onBusinessOperation"])]),D("div",Y,[u(c,{page:e.query.page,"onUpdate:page":t[5]||(t[5]=t=>e.query.page=t),total:e.pageTotal,onPage:e.getData},null,8,["page","total","onPage"])])]),D("div",Z,[u(b,{"destroy-on-close":"",modelValue:e.visible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.visible=t),"close-on-click-modal":!1,onClose:t[8]||(t[8]=()=>e.editData={})},{default:p((()=>[u(f,{editData:e.editData,config:e.editorConfig,onSuccess:e.handleEditorUpdate,onUpdateSuccess:e.handleEditorUpdate,onCreateSuccess:e.handleEditorCreate,onFail:e.handleEditorFail,onCancel:t[6]||(t[6]=t=>e.visible=!1)},null,8,["editData","config","onSuccess","onUpdateSuccess","onCreateSuccess","onFail"])])),_:1},8,["modelValue"])])],64)},M.__scopeId="data-v-ffb27d4e";export{M as default};
