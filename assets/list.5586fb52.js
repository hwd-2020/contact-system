import{d as e,r as t,o as a,c as o,w as i,e as l,b as n,g as s,F as r,f as d,t as p,x as c,p as u,a as h,h as f}from"./vendor.f2c1d879.js";var m=e({emits:["update:search","search","operation-request","operation-visible"],props:{search:{type:String,default:""},headOperation:{type:Array,default:()=>[]}},data(){return{searched:!1,content:this.search}},watch:{search(){this.content=this.search},content(){this.$emit("update:search",this.content),this.searched=!1}},methods:{handleButton(e,t,a){({request:()=>this.$emit("operation-request",a),router:()=>this.$router.push(t),open:()=>this.$emit("operation-visible")})[e]()},handleSearch(){this.$emit("search",this.content),this.searched=!0},handleRefresh(){this.content="",this.$emit("update:search",this.content),this.$emit("search",this.content)}}});const g={key:0,class:"refresh"},b={key:1,class:"search"};m.render=function(e,c,u,h,f,m){const y=t("el-button"),v=t("el-col"),k=t("el-input"),C=t("el-row");return a(),o(C,{gutter:20},{default:i((()=>[l(v,{span:10},{default:i((()=>[(a(!0),n(r,null,s(e.headOperation,(t=>(a(),o(y,{key:t.text,icon:t.icon,type:t.type,onClick:a=>e.handleButton(t.event,t.path,t.url)},{default:i((()=>[d(p(t.text),1)])),_:2},1032,["icon","type","onClick"])))),128))])),_:1}),l(v,{span:14},{default:i((()=>[l(k,{modelValue:e.content,"onUpdate:modelValue":c[0]||(c[0]=t=>e.content=t),placeholder:"输入查询条件",clearable:""},{append:i((()=>[e.searched?(a(),n("span",g,[l(y,{icon:"el-icon-refresh-right",onClick:e.handleRefresh},null,8,["onClick"])])):(a(),n("span",b,[l(y,{icon:"el-icon-search",onClick:e.handleSearch},null,8,["onClick"])]))])),_:1},8,["modelValue"])])),_:1})])),_:1})};var y=e({emits:["update:page","page"],props:{total:{type:Number,defualt:0},page:{type:Number,default:0}},data(){return{current:this.page}},watch:{page(e){this.current=e},current(e){this.$emit("update:page",e),this.$emit("page",e)}}});const v={class:"pagination"};y.render=function(e,o,i,s,r,d){const p=t("el-pagination");return a(),n("div",v,[l(p,{background:"",layout:"prev, pager, next","page-size":20,total:e.total,"current-page":e.current,"onUpdate:current-page":o[0]||(o[0]=t=>e.current=t)},null,8,["total","current-page"])])};var k=e({emits:["data-delete","data-edit","business-operation"],props:{tableData:{type:Array,default:()=>[]},fields:{type:Array,default:()=>[]},businessOperation:{type:Array,default:()=>[]},operation:{type:Object,default:()=>({})}},methods:{formatField(e,t,a,o){const i=this.fields[t.no-1].format;if("number"==typeof a){return{amount:a.toFixed(2)}[i.type]}if("string"==typeof a)return i[a]}}});k.render=function(e,u,h,f,m,g){const b=t("el-table-column"),y=t("el-button"),v=t("hwd-btn-delete"),k=t("el-table");return a(),o(k,{data:e.tableData,stripe:"",height:"100%"},{default:i((()=>[l(b,{type:"index",width:"50"}),(a(!0),n(r,null,s(e.fields,(t=>(a(),o(b,{key:t.prop,"show-overflow-tooltip":"","min-width":t.width,align:t.align||"center",prop:t.prop,label:t.label,formatter:t.format&&e.formatField},null,8,["min-width","align","prop","label","formatter"])))),128)),e.businessOperation&&e.businessOperation.length>0?(a(),o(b,{key:0,label:"业务操作",align:"center",width:"160",fixed:"right"},{default:i((t=>[(a(!0),n(r,null,s(e.businessOperation,(l=>(a(),n(r,{key:l},[t.row.state===l.state?(a(),o(y,{key:0,size:"mini",onClick:a=>e.$emit("business-operation",l,t.row,t.$index)},{default:i((()=>[d(p(l.text),1)])),_:2},1032,["onClick"])):c("",!0)],64)))),128))])),_:1})):c("",!0),e.operation.edit||e.operation.delete?(a(),o(b,{key:1,label:"数据操作",align:"center",width:"120",fixed:"right"},{default:i((t=>[e.operation.edit?(a(),o(y,{key:0,size:"mini",icon:"el-icon-edit-outline",onClick:a=>e.$emit("data-edit",t.row,t.$index)},null,8,["onClick"])):c("",!0),e.operation.delete?(a(),o(v,{key:1,removeID:t.row._id,onConfirm:a=>e.$emit("data-delete",t.row,t.$index)},null,8,["removeID","onConfirm"])):c("",!0)])),_:1})):c("",!0)])),_:1},8,["data"])},k.__scopeId="data-v-5b5282e2";var C=e({emits:["cancel"],props:{editData:{type:Object,default:()=>{}}},data(){return{form:this.editData,http:{},editorConfig:[]}},watch:{editData(e){this.form=e}},mounted(){this.getData()},methods:{getData(){const e=sessionStorage.getItem("frame");if(e){const t=JSON.parse(e)[this.$route.params.view];this.http=t.http,this.editorConfig=t.editorConfig}},handleUpload(e){return this.onUpload(this.$refs.upload.action,{file:e,callback:e=>this.form.cover=e}),!1},onUpload(e,t){const{file:a,callback:o}=t,i=`goods-cover-${this.form.id||a.name}-${Date.now()}.jpg`,l=new FormData;l.append("path",i),l.append("file",a),this.$httpRequest({url:e,method:"post",data:l,onSuccess:e=>{o&&o(e.url)}})},handleSubmit(){console.log(this.form),this.$httpRequest({url:this.form._id?this.http.update:this.http.create,method:this.form._id?"put":"post",data:this.form})},handleCancel(){this.$emit("cancel")}}});u("data-v-51f8e2b5");const D={id:"view-editor"},$={class:"editor-form"},w={class:"avatar-cover"},_=["src"],O={key:1,class:"el-icon-plus avatar-uploader-icon"},V=d("取消");h(),C.render=function(e,u,h,m,g,b){const y=t("el-input"),v=t("el-date-picker"),k=t("el-switch"),C=t("el-upload"),U=t("hwd-tinymce"),q=t("el-form-item"),x=t("el-button"),S=t("el-form");return a(),n("div",D,[f("div",$,[l(S,{"label-position":"left",ref:"form",model:e.form,"label-width":"150px"},{default:i((()=>[(a(!0),n(r,null,s(e.editorConfig,(t=>(a(),o(q,{key:t,label:t.label},{default:i((()=>[t.type&&"text"!==t.type&&"number"!==t.type?c("",!0):(a(),o(y,{key:0,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,type:t.type,placeholder:t.placeholder,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","type","placeholder","disabled"])),"datetime"===t.type?(a(),o(v,{key:1,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,type:t.type,placeholder:t.placeholder},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):c("",!0),"switch"===t.type?(a(),o(k,{key:2,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,"active-value":t.switch.on,"inactive-value":t.switch.off},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value"])):"upload"===t.type?(a(),o(C,{key:3,class:"avatar-uploader",ref:"upload",action:t.uploadURL,"show-file-list":!1,"before-upload":e.handleUpload},{default:i((()=>[f("div",w,[e.form[t.field]?(a(),n("img",{key:0,src:e.form[t.field],class:"avatar"},null,8,_)):(a(),n("i",O))])])),_:2},1032,["action","before-upload"])):"textarea"===t.type?(a(),o(U,{key:4,modelValue:e.form[t.field],"onUpdate:modelValue":a=>e.form[t.field]=a,onUploadImage:a=>e.onUpload(t.uploadURL,a)},null,8,["modelValue","onUpdate:modelValue","onUploadImage"])):c("",!0)])),_:2},1032,["label"])))),128)),l(q,null,{default:i((()=>[l(x,{type:"primary",onClick:e.handleSubmit},{default:i((()=>[d(p(e.form._id?"更新":"创建"),1)])),_:1},8,["onClick"]),l(x,{onClick:e.handleCancel},{default:i((()=>[V])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])])},C.__scopeId="data-v-51f8e2b5";var U=e({components:{"contact-head":m,"contact-table":k,"contact-page":y,"contact-editor":C},data:()=>({visible:!1,query:{search:"",page:1},pageTotal:0,tableData:[],editData:{},frameConfig:{}}),mounted(){this.getData()},watch:{$route(e){/^\/list/.test(e.path)&&e.params.view&&this.getData()}},methods:{getData(){this.tableData=[];const e=sessionStorage.getItem("frame");if(e){const t=JSON.parse(e);this.frameConfig=t[this.$route.params.view],this.frameConfig&&this.$httpRequest({url:`${this.frameConfig.http.retrieve}?search=${this.query.search}&page=${this.query.page}`,onSuccess:e=>{this.tableData=e.list,this.pageTotal=e.total}})}},handleEdit(e){console.log(e),this.editData=e,this.visible=!0},handleDelete(e){this.$httpRequest({url:`${this.frameConfig.http.delete}?id=${e}`,method:"delete",onSuccess:()=>this.tableData=this.tableData.filter((t=>t._id!==e))})},handleHeadOperationRequest(e){console.log(e),this.$httpRequest({url:e,onSuccess:e=>this.tableData.push(e)})},handleBusinessOperation(e,t,a){const o={confirmButtonText:"确定",cancelButtonText:"取消",type:"info"};({confirm:()=>this.$confirm(e.desc,e.text,o),prompt:()=>this.$prompt(e.desc,e.text,o)})[e.msg]().then((({value:o=""})=>{const i={};for(const a in e.body){const l=a.split(":")[0],n=a.split(":")[1];"key"===l?i[n]=t[e.body[a]]:"val"===l?i[n]=e.body[a]:"input"===l&&(i[n]=o)}this.$httpRequest({url:e.url,method:"post",data:i,onSuccess:e=>{for(const t in e)this.tableData[a][t]=e[t]}})})).catch((()=>this.$message({type:"info",message:"取消操作"})))},request(){}}});u("data-v-4a668c64");const q={id:"view-list"},x={class:"list-head"},S={class:"list-table"},R={class:"list-foot"},I={id:"view-list-dialog"};h(),U.render=function(e,o,s,d,p,c){const u=t("contact-head"),h=t("contact-table"),m=t("contact-page"),g=t("contact-editor"),b=t("el-dialog");return a(),n(r,null,[f("div",q,[f("div",x,[l(u,{search:e.query.search,"onUpdate:search":o[0]||(o[0]=t=>e.query.search=t),headOperation:e.frameConfig?e.frameConfig.headOperation:[],onSearch:e.getData,onOperationRequest:e.handleHeadOperationRequest,onOperationVisible:o[1]||(o[1]=t=>e.visible=!0)},null,8,["search","headOperation","onSearch","onOperationRequest"])]),f("div",S,[l(h,{tableData:e.tableData,fields:e.frameConfig&&e.frameConfig.fields,businessOperation:e.frameConfig?e.frameConfig.businessOperation:[],operation:e.frameConfig&&e.frameConfig.dataOperation,onDataEdit:o[2]||(o[2]=(t,a)=>e.handleEdit(t)),onDataDelete:o[3]||(o[3]=t=>e.handleDelete(t._id)),onBusinessOperation:e.handleBusinessOperation},null,8,["tableData","fields","businessOperation","operation","onBusinessOperation"])]),f("div",R,[l(m,{page:e.query.page,"onUpdate:page":o[4]||(o[4]=t=>e.query.page=t),total:e.pageTotal,onPage:e.getData},null,8,["page","total","onPage"])])]),f("div",I,[l(b,{title:"商品分类",modelValue:e.visible,"onUpdate:modelValue":o[6]||(o[6]=t=>e.visible=t),"close-on-click-modal":!1,onClose:o[7]||(o[7]=()=>e.editData={})},{default:i((()=>[l(g,{editData:e.editData,onCancel:o[5]||(o[5]=t=>e.visible=!1)},null,8,["editData"])])),_:1},8,["modelValue"])])],64)},U.__scopeId="data-v-4a668c64";export{U as default};
